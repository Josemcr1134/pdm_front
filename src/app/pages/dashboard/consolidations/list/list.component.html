<div *ngIf="!isLoading">
  <div class="block p-3 bg-white rounded-xl">
    <div class="flex flex-wrap items-center gap-5 mb-5">
      <div class="flex flex-wrap items-center gap-4">
        <p class="text-base font-bold text-black">Consolidaciones</p>
      </div>
      <div class="grid grid-cols-1">
        <select (change)="getConsolidations()" [(ngModel)]="yearSelected" aria-label="Select a tab"
          class="w-24 col-start-1 row-start-1 py-2 pl-3 pr-8 text-base text-gray-900 bg-white rounded-md appearance-none outline outline-1 -outline-offset-1 outline-gray-300 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600">
          <option [value]="years?.first_year">{{years?.first_year}}</option>
          <option [value]="years?.second_year">{{years?.second_year}}</option>
          <option [value]="years?.third_year">{{years?.third_year}}</option>
          <option [value]="years?.fourth_year">{{years?.fourth_year}}</option>
        </select>
        <svg class="self-center col-start-1 row-start-1 mr-2 pointer-events-none size-5 justify-self-end fill-gray-500"
          viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" data-slot="icon">
          <path fill-rule="evenodd"
            d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z"
            clip-rule="evenodd" />
        </svg>
      </div>
      <div class="w-full">
        <input type="text" name="text" (keyup)="onSearchInput()" [(ngModel)]="search" id="text" autocomplete="off"
          placeholder="Buscar"
          class="block mb-3 w-full rounded-2xl bg-gray-100 px-3 py-1 md:py-1.5 text-sm md:text-base text-primary outline outline-1 -outline-offset-1 outline-gray-100 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6">
      </div>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm text-left text-gray-800">
        <thead>
          <tr class="text-xs text-white rounded-t-lg bg-primary">
            <th colspan="3" class="px-4 py-4 text-center bg-yellow-400 rounded-tl-lg">PLAN DE DESARROLLO</th>
            <th colspan="8" class="px-4 py-4 text-center">PLAN DE DESARROLLO</th>
            <th colspan="9" class="px-4 py-4 text-center border-x">REPORTE DE LA PIIP</th>
            <th colspan="2" class="px-4 py-4 text-center ">CUIPO</th>
            <th colspan="2" class="px-4 py-4 text-center rounded-tr-lg">CONVERSIÓN DE LA UNIDAD DE MEDIDAD Y META DEL
              CUATRENIO ENTRE EL PDM Y LA PIB</th>
          </tr>
          <tr class="text-white ">
            <th class="px-4 py-2.5 text-nowrap bg-yellow-400">META DEL PLAN DE DESARROLLO</th>
            <th class="px-4 py-2.5 text-nowrap bg-yellow-400">UNIDAD DE MEDIDA</th>
            <th class="px-4 py-2.5 text-nowrap bg-yellow-400">META DEL CUATRENIO</th>
            <!-- PDM HEADERS -->
            <th class="px-4 py-2.5 bg-blue-400 text-nowrap">SECTOR</th>
            <th class="px-4 py-2.5 bg-green-400 text-nowrap">BPIN</th>

            <th class="px-4 py-2.5 bg-orange-300 text-nowrap">CÓD. PRODUCTO MGA</th>
            <th class="px-4 py-2.5  bg-yellow-500 text-nowrap ">PRODUCTO DE LA MGA</th>
            <th class="px-4 py-2.5 bg-gray-500 text-nowrap">CÓD. INDICADOR DE PRODUCTO</th>
            <th class="px-4 py-2.5 bg-red-500 text-nowrap">INDICADOR DE PRODUCTO MGA</th>
            <th class="px-4 py-2.5 bg-orange-600 text-nowrap">APROPIACIÓN INICIAL</th>
            <th class="px-4 py-2.5 bg-green-600  text-nowrap">TOTAL APROPIADO</th>

            <!-- PIIP HEADERS -->
            <th class="px-4 py-2.5 bg-blue-400 text-nowrap">SECTOR</th>
            <th class="px-4 py-2.5 bg-green-400 text-nowrap">BPIN</th>

            <th class="px-4 py-2.5 bg-orange-300 text-nowrap">CÓD. PRODUCTO MGA</th>
            <th class="px-4 py-2.5 bg-yellow-500 text-nowrap ">PRODUCTO DE LA MGA</th>
            <th class="px-4 py-2.5  bg-gray-500 text-nowrap">CÓD. INDICADOR DE PRODUCTO</th>
            <th class="px-4 py-2.5 bg-red-500 text-nowrap">INDICADOR DE PRODUCTO MGA</th>
            <th class="px-4 py-2.5 text-gray-800 text-nowrap">META TOTAL DE INDICADOR</th>
            <th class="px-4 py-2.5 bg-orange-600  text-nowrap">APROPIACIÓN INICIAL</th>
            <th class="px-4 py-2.5 bg-green-600  text-nowrap">TOTAL APROPIADO</th>

            <!-- CUIPO HEADERS -->
            <th class="px-4 py-2.5 bg-green-400 text-nowrap">BPIN</th>
            <th class="px-4 py-2.5 bg-orange-300 text-nowrap">CÓD. PRODUCTO MGA</th>
            <!-- COMPARATIONS HEADERS -->
            <th class="px-4 py-2.5 text-gray-800  text-nowrap">UNIDAD DE MEDIDA</th>
            <th class="px-4 py-2 text-gray-800 text-nowrap">META TOTAL</th>
          </tr>
        </thead>
        <tbody>
          <!-- Ejemplo fila -->
          <tr *ngFor="let c of Consolidations" class="hover:bg-gray-100">
            <td class="px-4 py-2 border">{{c.goal_name || 'No definido'}}</td>
            <td class="px-4 py-2 border">{{c.unit_measurement || 'No definido'}}</td>
            <td class="px-4 py-2 border">{{c.goal_four_years }} </td>

            <!-- PDM VALUES -->
            <td class="px-4 py-2 border">
              {{c.pdm.sector || 'No definido'}}
              <span *ngIf="hasAlert(c, 'sector')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.pdm.bpin }}
              <span *ngIf="hasAlert(c, 'bpin')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.pdm.code_producto_mga }}
              <span *ngIf="hasAlert(c, 'code_producto_mga')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.pdm.producto_mga || 'No definido'}}
              <span *ngIf="hasAlert(c, 'producto_mga')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.pdm.code_indicator_mga }}
              <span *ngIf="hasAlert(c, 'code_indicator_mga')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.pdm.indicator_mga || 'No definido'}}
              <span *ngIf="hasAlert(c, 'indicator_mga')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.pdm.initial_appropriation | currency}}
              <span *ngIf="hasAlert(c, 'initial_appropriation')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.pdm.total_appropriate | currency}}
              <span *ngIf="hasAlert(c, 'total_appropriate')" class="ml-1 text-red-500">⚠️</span>
            </td>

            <!-- PIIP VALUES -->
            <td class="px-4 py-2 border">
              {{c.piip.sector_piip || 'No definido'}}
              <span *ngIf="hasAlert(c, 'sector_piip')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.piip.bpin_piip }}
              <span *ngIf="hasAlert(c, 'bpin_piip')" class="ml-1 text-red-500">⚠️</span>
            </td>

            <td class="px-4 py-2 border">
              {{c.piip.code_producto_mga_piip}}
              <span *ngIf="hasAlert(c, 'code_producto_mga_piip')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.piip.producto_mga_piip || 'No definido'}}
              <span *ngIf="hasAlert(c, 'producto_mga_piip')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.piip.code_indicator_mga_piip}}
              <span *ngIf="hasAlert(c, 'code_indicator_mga_piip')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.piip.indicator_mga_piip || 'No definido'}}
              <span *ngIf="hasAlert(c, 'indicator_mga_piip')" class="ml-1 text-red-500">⚠️</span>
            </td>

            <td class="px-4 py-2 border">
              {{c.piip.total_indicator_goal_piip }}
              <span *ngIf="hasAlert(c, 'total_indicator_goal_piip')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.piip.initial_appropriation_piip | currency}}
              <span *ngIf="hasAlert(c, 'initial_appropriation_piip')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.piip.total_appropriate_piip | currency}}
              <span *ngIf="hasAlert(c, 'total_appropriate_piip')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.cuipo.bpin_cuipo | currency}}
              <span *ngIf="hasAlert(c, 'bpin_cuipo')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              {{c.cuipo.code_producto_mga_cuipo | currency}}
              <span *ngIf="hasAlert(c, 'code_producto_mga_cuipo')" class="ml-1 text-red-500">⚠️</span>
            </td>

            <!-- COMPARATIONS -->
            <td class="px-4 py-2 border">
              {{c.unit_measurement || 'No definido'}}
              <span *ngIf="hasAlert(c, 'total_appropriate_piip')" class="ml-1 text-red-500">⚠️</span>
            </td>
            <td class="px-4 py-2 border">
              <span *ngIf="hasAlert(c, 'total_indicator_goal_piip')" class="ml-1 text-red-500">⚠️</span>
              {{c.piip.total_indicator_goal_piip }}
            </td>


          </tr>
        </tbody>
      </table>
    </div>
    <!-- PAGINATION -->
    <app-pagination [limit]="limit" [offset]="offset" [totalItems]="totalItems"
      (onPageChange)="pageChange($event)"></app-pagination>
  </div>
</div>
<div *ngIf="isLoading" class="flex items-center justify-center h-full">
  <app-loader></app-loader>
</div>
